{"version":3,"sources":["./src/app/pages/chat/chat.page.html","./src/app/pages/chat/chat.module.ts","./src/app/pages/chat/chat.page.scss","./src/app/pages/chat/chat.page.ts","./src/app/services/profile-photo.service.ts"],"names":[],"mappings":"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","file":"pages-chat-chat-module-es5.js","sourcesContent":["module.exports = \"<ion-content (swipeleft)=\\\"swipeLeft()\\\" padding>\\n  <ion-item-group class=\\\"contenitore\\\" *ngFor=\\\"let chat of chatsList \\\">\\n    <div *ngIf=\\\"chat.payload.val().messages || (chat.payload.val().newMess == true)\\\">\\n      <ion-item>\\n        <ion-avatar slot=\\\"start\\\">\\n          <img (click)=\\\"openPhoto(chat.payload.val().foto)\\\" src=\\\"{{chat.payload.val().foto}}\\\">\\n        </ion-avatar>\\n        <ion-label (press)=\\\"options()\\\"\\n          (click)=\\\"openChat(chat.payload.key,chat.payload.val().firstname,chat.payload.val().lastname,chat.payload.val().foto)\\\">\\n          <ion-text>{{chat.payload.val().firstname}} {{ chat.payload.val().lastname}}</ion-text>\\n          <p *ngIf=\\\"chat.payload.val().newMess == true\\\" color=\\\"success\\\"> Nuovi/o messaggi/o</p>\\n        </ion-label>\\n      </ion-item>\\n    </div>\\n  </ion-item-group>\\n</ion-content>\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChatPage } from './chat.page';\nimport { SharedModule } from 'src/app/shared/shared.module';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChatPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    SharedModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [ChatPage]\n})\nexport class ChatPageModule {}\n","module.exports = \"ion-content {\\n  --padding-bottom: 20%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2RhdmlkZS9TY3JpdmFuaWEvbnVvdmlQcm9nZXR0aS90ZWxsbWUvdGVsbE1lL3NyYy9hcHAvcGFnZXMvY2hhdC9jaGF0LnBhZ2Uuc2NzcyIsInNyYy9hcHAvcGFnZXMvY2hhdC9jaGF0LnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLHFCQUFBO0FDQ0oiLCJmaWxlIjoic3JjL2FwcC9wYWdlcy9jaGF0L2NoYXQucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaW9uLWNvbnRlbnQge1xuICAgIC0tcGFkZGluZy1ib3R0b206IDIwJTtcbn0iLCJpb24tY29udGVudCB7XG4gIC0tcGFkZGluZy1ib3R0b206IDIwJTtcbn0iXX0= */\"","import { FcmService } from './../../services/fcm.service';\nimport { ModalController } from '@ionic/angular';\nimport { PhotoModalPage } from './../photo-modal/photo-modal.page';\nimport { ProfilePhotoService } from './../../services/profile-photo.service';\nimport { UploadTask } from '@angular/fire/storage/interfaces';\nimport { map } from 'rxjs/operators';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AuthService } from './../../services/auth.service';\nimport { UsersService } from 'src/app/services/users.service';\nimport { ChatService } from './../../services/chat.service';\nimport { Component, OnInit, Output, EventEmitter } from '@angular/core';\nimport { Router, NavigationExtras } from '@angular/router';\nimport { SendMessageService } from 'src/app/services/send-message.service';\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.page.html',\n  styleUrls: ['./chat.page.scss'],\n})\n\nexport class ChatPage implements OnInit {\n\n  chats: any;\n  chatUser: any\n  $key: any;\n  idLoggedUser: string;\n  chatsList;\n  users;\n\n  // firstname: string;\n  // lastname: string;\n  email: string;\n\n  registeredUser: {\n    firstname: string,\n    lastname: string,\n    email: string,\n    photo: any\n  };\n\n  task: UploadTask;\n  url: any;\n\n  token;\n\n\n\n  constructor(\n    private chatService: ChatService,\n    private afAuth: AngularFireAuth,\n    private usersService: UsersService,\n    private router: Router,\n    private sendMessageService: SendMessageService,\n    private authService: AuthService,\n    private profilePhotoService: ProfilePhotoService,\n    private modalController: ModalController,\n    private fcmService: FcmService\n  ) {\n\n\n    this.registeredUser = this.authService.getRegisteredUser();\n\n    this.idLoggedUser = this.authService.getIdLoggedUser();\n\n\n    this.fcmService.getAndSaveToken(this.idLoggedUser);\n\n    this.usersService.getUsers().subscribe(users => {\n      let arr = users.find(item => {\n        return item.key == this.idLoggedUser;\n      })\n      if (!arr) {\n        let fileName = Date.now();\n        if (this.registeredUser.photo) {\n          this.task = this.profilePhotoService.upLoad(this.idLoggedUser, fileName).put(this.registeredUser.photo);\n          this.task.then(() => {\n            this.profilePhotoService.upLoad(this.idLoggedUser, fileName).getDownloadURL().then(url => {\n              this.url = url;\n              this.usersService.createUser(this.idLoggedUser).set({\n                firstname: this.registeredUser.firstname,\n                lastname: this.registeredUser.lastname,\n                email: this.registeredUser.email,\n                uid: this.idLoggedUser,\n                photo: url\n              })\n            })\n          })\n        } else {\n          this.url = './../assets/anonymous.png';\n          this.usersService.createUser(this.idLoggedUser).set({\n            firstname: this.registeredUser.firstname,\n            lastname: this.registeredUser.lastname,\n            email: this.registeredUser.email,\n            uid: this.idLoggedUser,\n            photo: './../assets/anonymous.png'\n          })\n        }\n      }\n    })\n\n    this.getChatsList();\n    if (this.idLoggedUser) {\n      this.authService.onlineUsers(this.idLoggedUser).update({\n        online: true\n      })\n    } else {\n      alert('Esegui il login, ritenta!');\n      this.router.navigateByUrl('/login');\n    }\n  }\n  ngOnInit() {\n    if (this.idLoggedUser) {\n      this.authService.onlineUsers(this.idLoggedUser).update({\n        online: true\n      })\n    } else {\n      this.router.navigateByUrl('/login');\n\n    }\n\n  }\n\n  ionViewDidEnter() {\n    if (this.idLoggedUser) {\n      this.authService.onlineUsers(this.idLoggedUser).update({\n        online: true\n      })\n    } else {\n      this.router.navigateByUrl('/login');\n    }\n  }\n  ionViewWillEnter() {\n\n    // this.authService.onlineUsers(this.idLoggedUser).update({\n    //   online: true\n    // })\n    this.getChatsList();\n  }\n\n  getChatsList() {\n    this.chatService.getChatsList(this.idLoggedUser).subscribe(res => {\n      this.chatsList = res;\n    })\n  }\n\n\n  openChat(idFriend, firstnameFriend, lastnameFriend, photoFriend) {\n\n    this.chatService.getClickedUserData(idFriend, firstnameFriend, lastnameFriend, photoFriend);\n\n    this.sendMessageService.newMessages(this.idLoggedUser, idFriend).update({\n      newMess: false\n    })\n\n    this.router.navigate(['user-chat']);\n  }\n\n\n  openPhoto(url) {\n    this.presentModal(url)\n  }\n\n  async presentModal(url) {\n    const modal = await this.modalController.create({\n      component: PhotoModalPage,\n      componentProps: { url: url }\n    });\n    return await modal.present();\n  }\n\n  swipeLeft() {\n    this.router.navigateByUrl('/home/stato');\n  }\n\n  options() {\n    console.log('ciao');\n    alert('ciao')\n  }\n\n\n}\n","import { AngularFireDatabase } from '@angular/fire/database';\nimport { AngularFireStorage } from '@angular/fire/storage';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProfilePhotoService {\n\n  constructor(\n    private storage: AngularFireStorage,\n    private db: AngularFireDatabase\n    ) { }\n\n    upLoad(idLogged, fileName) {\n      return this.storage.storage.ref(`fotoProfilo/${idLogged}/${fileName}`);\n    }\n\n    savePhotoProfile(idLogged) {\n      return this.db.database.ref(`/users/${idLogged}/`);\n    }\n}\n"],"sourceRoot":""}